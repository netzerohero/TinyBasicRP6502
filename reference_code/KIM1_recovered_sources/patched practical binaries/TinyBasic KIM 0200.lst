0001   0000             ;
0002   0000             ; Tiny Basic Tom Pittmman
0003   0000             ;
0004   0000             ; reconstructed version of the KIM-1 versions from tape Hans Oten
0005   0000             ; delivers byte for byte equal version of binary 0200- or 2000-
0006   0000             ; KIM breaktest included, removed from $0100 to end of program
0007   0000             ; - Prompt changed to '>'
0008   0000             ; - backspace is $08
0009   0000             ; - paddding removed
0010   0000             ;
0011   0000             ; Hans Otten, December 2023 
0012   0000             ;
0013   0000             ; TASM syntax
0014   0000             ;
0015   0000             ; KIM defines 
0016   0000             ;
0017   0000             GETCH    = $1E5A          ; KIM character input routine
0018   0000             OUTCH    = $1EA0          ; KIM character output routine
0019   0000             FREERAM  = $0B00          ; Start of free RAM for program storage. must be page boundary, $0B00 low version for high version $2900
0020   0000             KTTY	 = $1740		  ; Break test if PB7 low at TTY input  
0021   0000             ;
0022   0000             ; Tiny Basic starts here
0023   0000             ;
0024   0200                      .org     $0200             ; Start of Basic. KIM versions at $0200 and $2000 
0025   0200             START
0026   0200             
0027   0200 4C 85 02    CV       JMP      COLD_S            ; Cold start vector
0028   0203 4C BD 02    WV       JMP      WARM_S            ; Warm start vector
0029   0206 4C 5A 1E    IN_V     JMP      GETCH             ; Input routine address. 
0030   0209 4C A0 1E    OUT_V    JMP      OUTCH             ; Output routine address.
0031   020C 4C CA 0A    BV       JMP      KIMBT             ; Begin break routine
0032   020F             
0033   020F             ;
0034   020F             ; Some codes
0035   020F             ;
0036   020F 08          BSC      .byte $08                   ; Backspace code was $5f
0037   0210 18          LSC      .byte $18                   ; Line cancel code
0038   0211 00          PCC      .byte $00                   ; Pad character control was DEFAULT 84 (pad enabled bit 7, 4 pad characters
0039   0212 80          TMC      .byte $80                   ; Tape mode control
0040   0213 20          SSS      .byte $20                   ; Spare Stack size. (was $04 but documentation suggests $20)
0041   0214             
0042   0214             ;
0043   0214             ; Code fragment for 'PEEK' and 'POKE'
0044   0214             ;
0045   0214 86 C3       PEEK     STX $C3                   ; 'PEEK' - store X in $C3
0046   0216 90 05                BCC LBL008                ; On carry clear goto LBL008
0047   0218 86 C3                STX $C3                   ; 'POKE' - store X in $C3
0048   021A 91 C2                STA ($C2),Y               ; Store A in location pointed to by $C3 (hi) and Y (lo)
0049   021C 60                   RTS                       ; Return
0050   021D B1 C2       LBL008   LDA ($C2),Y               ; Load A with value pointed to by $C3 (hi) and Y (lo)
0051   021F A0 00                LDY #$00                  ; Reset Y
0052   0221 60                   RTS                       ; Return
0053   0222             
0054   0222             ;
0055   0222             ; The following table contains the addresses for the ML handlers for the IL opcodes.
0056   0222             ;
0057   0222 62 03       SRVT     .word  IL_BBR               ; ($40-$5F) Backward Branch Relative
0058   0224 64 03                .word  IL_FBR               ; ($60-$7F) Forward Branch Relative
0059   0226 D8 03                .word  IL__BC               ; ($80-$9F) String Match Branch
0060   0228 05 04                .word  IL__BV               ; ($A0-$BF) Branch if not Variable
0061   022A 33 04                .word  IL__BN               ; ($C0-$DF) Branch if not a Number
0062   022C FD 03                .word  IL__BE               ; ($E0-$FF) Branch if not End of line
0063   022E 9F 05                .word  IL__NO               ; ($08) No Opertion
0064   0230 42 09                .word  IL__LB               ; ($09) Push Literal Byte onto Stack
0065   0232 3F 09                .word  IL__LN               ; ($0A) Push Literal Number
0066   0234 7A 05                .word  IL__DS               ; ($0B) Duplicate Top two bytes on Stack
0067   0236 FC 06                .word  IL__SP               ; ($0C) Stack Pop
0068   0238 95 05                .word  LBL097                ; ($0D) (Reserved)
0069   023A 9F 05                .word  IL__NO               ; ($0E) (Reserved)
0070   023C 9F 05                .word  IL__NO               ; ($0F) (Reserved)
0071   023E BD 08                .word  IL__SB               ; ($10) Save Basic Pointer
0072   0240 C1 08                .word  IL__RB               ; ($11) Restore Basic Pointer
0073   0242 8A 08                .word  IL__FV               ; ($12) Fetch Variable
0074   0244 9B 08                .word  IL__SV               ; ($13) Store Variable
0075   0246 E9 08                .word  IL__GS               ; ($14) Save GOSUB line
0076   0248 61 05                .word  IL__RS               ; ($15) Restore saved line
0077   024A 51 05                .word  IL__GO               ; ($16) GOTO
0078   024C 41 08                .word  IL__NE               ; ($17) Negate
0079   024E 52 08                .word  IL__AD               ; ($18) Add
0080   0250 4F 08                .word  IL__SU               ; ($19) Subtract
0081   0252 62 08                .word  IL__MP               ; ($1A) Multiply
0082   0254 E7 07                .word  IL__DV               ; ($1B) Divide
0083   0256 CD 04                .word  IL__CP               ; ($1C) Compare
0084   0258 06 05                .word  IL__NX               ; ($1D) Next BASIC statement
0085   025A 9F 05                .word  IL__NO               ; ($1E) (Reserved)
0086   025C 15 06                .word  IL__LS               ; ($1F) List the program
0087   025E A7 05                .word  IL__PN               ; ($20) Print Number
0088   0260 B7 04                .word  IL__PQ               ; ($21) Print BASIC string
0089   0262 BF 04                .word  IL__PT               ; ($22) Print Tab
0090   0264 83 06                .word  IL__NL               ; ($23) New Line
0091   0266 A1 04                .word  IL__PC               ; ($24) Print Literal String
0092   0268 9F 05                .word  IL__NO               ; ($25) (Reserved)
0093   026A 9F 05                .word  IL__NO               ; ($26) (Reserved)
0094   026C A8 06                .word  IL__GL               ; ($27) Get input Line
0095   026E 4F 09                .word  ILRES1               ; ($28) (Seems to be reserved - No IL opcode calls this)
0096   0270 4D 09                .word  ILRES2               ; ($29) (Seems to be reserved - No IL opcode calls this)
0097   0272 07 07                .word  IL__IL               ; ($2A) Insert BASIC Line
0098   0274 AA 02                .word  IL__MT               ; ($2B) Mark the BASIC program space Empty
0099   0276 37 05                .word  IL__XQ               ; ($2C) Execute
0100   0278 BD 02                .word  WARM_S               ; ($2D) Stop (Warm Start)
0101   027A 1B 09                .word  IL__US               ; ($2E) Machine Language Subroutine Call
0102   027C B1 08                .word  IL__RT               ; ($2F) IL subroutine return
0103   027E             
0104   027E 20 41 54 20 ERRSTR   .byte " AT "                ; " AT " string used in error reporting.  Tom was right about this.
0105   0282 80                   .byte $80                   ; String terminator
0106   0283                      
0107   0283 70 09       LBL002   .word  ILTBL                ; Address of IL program table
0108   0285             
0109   0285             ;
0110   0285             ; Begin Cold Start
0111   0285             ;
0112   0285             ; Load start of free RAM into locations $20 and $21
0113   0285             ; and initialize the address for end of free ram ($22 & $23)
0114   0285             ;
0115   0285 A9 00       COLD_S   lda #FREERAM&$FF          ; low byte for start of RAM
0116   0287 85 20       		 sta $20
0117   0289 85 22                sta $22                    ; Store $00 in $22
0118   028B A9 0B                lda #FREERAM/256           ; high byte fo start of RAM
0119   028D 85 21                sta $21                    ; Store $02 in $21
0120   028F 85 23                sta $23                    ; Store $02 in $23
0121   0291             ;
0122   0291             ;
0123   0291             ; Begin test for free ram
0124   0291             ;
0125   0291             
0126   0291 A0 01                ldy #$01                   ; Load register Y with $01
0127   0293 B1 22       MEM_T    lda ($22),Y                ; Load accumulator With the contents of a byte of memory
0128   0295 AA                   tax                        ; Save it to X
0129   0296 49 FF                eor #$FF                   ; Next 4 instuctions test to see if this memory location
0130   0298 91 22                sta ($22),Y                ; is ram by trying to write something new to it - new value
0131   029A D1 22                cmp ($22),Y                ; gets created by XORing the old value with $FF - store the
0132   029C 08                   php                        ; result of the test on the stack to look at later
0133   029D 8A                   txa                        ; Retrieve the old memory value
0134   029E 91 22                sta ($22),Y                ; Put it back where it came from
0135   02A0 E6 22                inc $22                    ; Increment $22 (for next memory location)
0136   02A2 D0 02                bne PULL                 ; Skip if we don't need to increment page
0137   02A4 E6 23                inc $23                    ; Increment $23 (for next memory page)
0138   02A6             PULL  
0139   02A6 28                   plp                        ; Now look at the result of the memory test
0140   02A7 F0 EA                beq MEM_T                  ; Go test the next memory location if the last one was ram
0141   02A9             TOP
0142   02A9 88                   dey                        ; If last memory location did not test as ram, decrement Y (should be $00 now)
0143   02AA             
0144   02AA D8          IL__MT   cld                        ; Make sure we're not in decimal mode
0145   02AB A5 20                lda $20                    ; Load up the low-order by of the start of free ram
0146   02AD 6D 13 02             adc SSS                    ; Add to the spare stack size
0147   02B0 85 24                sta $24                    ; Store the result in $0024
0148   02B2 98                   tya                        ; Retrieve Y
0149   02B3 65 21                adc $21                    ; And add it to the high order byte of the start of free ram (this does not look right)
0150   02B5 85 25                sta $25                    ; Store the result in $0025
0151   02B7 98                   tya                        ; Retrieve Y again
0152   02B8 91 20                sta ($20),Y                ; Store A in the first byte of program memory
0153   02BA C8                   iny                        ; Increment Y
0154   02BB 91 20                sta ($20),Y                ; Store A in the second byte of program memory
0155   02BD             ;
0156   02BD             ;Begin Warm Start
0157   02BD             ;
0158   02BD A5 22       WARM_S   lda $22
0159   02BF 85 C6                sta $C6
0160   02C1 85 26                sta $26
0161   02C3 A5 23                lda $23
0162   02C5 85 C7                sta $C7
0163   02C7 85 27                sta $27
0164   02C9 20 87 06             jsr P_NWLN                 ; Go print CR, LF and pad characters
0165   02CC AD 83 02    LBL014   lda LBL002                 ; Load up the start of the IL Table 
0166   02CF 85 2A                sta $2A                    ;
0167   02D1 AD 84 02             lda LBL002+$01             ;
0168   02D4 85 2B                sta $2B
0169   02D6 A9 80                lda #$80
0170   02D8 85 C1                sta $C1
0171   02DA A9 30                lda #$30
0172   02DC 85 C0                sta $C0
0173   02DE A2 00                ldx #$00
0174   02E0 86 BE                stx $BE
0175   02E2 86 C2                stx $C2
0176   02E4 CA                   dex
0177   02E5 9A                   txs
0178   02E6             
0179   02E6             ;
0180   02E6             ; IL execution loop
0181   02E6             ;
0182   02E6 D8          LBL006   cld                        ; Make sure we're in binary mode 
0183   02E7 20 F9 04             jsr LBL004                 ; Go read a byte from the IL program table
0184   02EA 20 F2 02             jsr LBL005                 ; Go decide what to do with it
0185   02ED 4C E6 02             jmp LBL006                 ; Repeat
0186   02F0             ;
0187   02F0             ;
0188   02F0             ;
0189   02F0 02                   .byte $02                   ; No idea about this
0190   02F1 53                   .byte $53                   ; No idea about this
0191   02F2             ;
0192   02F2             ;
0193   02F2             ; Routine to service the TBIL Instructions
0194   02F2             ;
0195   02F2 C9 30       LBL005   cmp #$30                   ;
0196   02F4 B0 7B                bcs LBL011                 ; If it's $30 or higher, it's a Branch or Jump - go handle it
0197   02F6 C9 08                cmp #$08                   ; 
0198   02F8 90 0C                bcc LBL007                 ; If it's less than $08 it's a stack exchange - go handle it
0199   02FA 0A                   asl a                       ; Multiply the OP code by 2 
0200   02FB AA                   tax                        ; Transfer it to X
0201   02FC BD 1F 02    LBL022   lda SRVT-$03,X             ; Get the hi byte of the OP Code handling routine
0202   02FF 48                   pha                        ; and save it on the stack
0203   0300 BD 1E 02             lda SRVT-$04,X             ; Get the lo byte
0204   0303 48                   pha                        ; and save it on the stack
0205   0304 08                   php                        ; save the processor status too
0206   0305 40                   rti                        ; now go execute the OP Code handling routine
0207   0306             ;
0208   0306             ;
0209   0306             ; Routine to handle the stack exchange 
0210   0306             ;
0211   0306 65 C1       LBL007   adc $C1
0212   0308 AA                   tax
0213   0309 B1 C1                lda ($C1),Y
0214   030B 48                   pha
0215   030C B5 00                lda $00,X
0216   030E 91 C1                sta ($C1),Y
0217   0310 68                   pla
0218   0311 95 00                sta $00,X
0219   0313 60                   rts
0220   0314             ;
0221   0314             ;
0222   0314             ;
0223   0314 20 87 06    LBL015   jsr P_NWLN                 ; Go print CR, LF and pad characters
0224   0317 A9 21                lda #$21                   ; '!' character
0225   0319 20 09 02             jsr OUT_V                  ; Go print it
0226   031C A5 2A                lda $2A                    ; Load the current TBIL pointer (lo) 
0227   031E 38                   sec                        ; Set the carry flag
0228   031F ED 83 02             sbc LBL002                 ; Subtract the TBIL table origin (lo)
0229   0322 AA                   tax                        ; Move the difference to X
0230   0323 A5 2B                lda $2B                    ; Load the current TBIL pointer (hi)
0231   0325 ED 84 02             sbc LBL002+$01             ; Subtract the TBIL table origin (hi)
0232   0328 20 A0 05             jsr LBL010
0233   032B A5 BE                lda $BE
0234   032D F0 12                beq LBL012
0235   032F A9 7E                lda #ERRSTR &$FF           ; Get lo byte of error string address
0236   0331 85 2A                sta $2A                    ; Put in $2A
0237   0333 A9 02                lda #ERRSTR/256            ; Get hi byte of error string address
0238   0335 85 2B                sta $2B                    ; Put in $2B
0239   0337 20 A1 04             jsr IL__PC                 ; Go report an error has been detected
0240   033A A6 28                ldx $28
0241   033C A5 29                lda $29
0242   033E 20 A0 05             jsr LBL010
0243   0341 A9 07       LBL012   lda #$07                   ; ASCII Bell
0244   0343 20 09 02             jsr OUT_V                  ; Go ring Bell
0245   0346 20 87 06             jsr P_NWLN                 ; Go print CR, LF and pad characters
0246   0349 A5 26       LBL060   lda $26
0247   034B 85 C6                sta $C6
0248   034D A5 27                lda $27
0249   034F 85 C7                sta $C7
0250   0351 4C CC 02             jmp LBL014
0251   0354             ;
0252   0354             ;
0253   0354             ;
0254   0354 A2 7C       LBL115   ldx #$7C
0255   0356 E4 C1       LBL048   cpx $C1
0256   0358 90 BA       LBL019   bcc LBL015
0257   035A A6 C1                ldx $C1
0258   035C E6 C1                inc $C1
0259   035E E6 C1                inc $C1
0260   0360 18                   clc
0261   0361 60                   rts
0262   0362             ;
0263   0362             ;
0264   0362             ;
0265   0362 C6 BD       IL_BBR   dec $BD                    ; Entry point for TBIL Backward Branch Relative
0266   0364 A5 BD       IL_FBR   lda $BD                    ; Entry point for TBIL Forward Branch Relative
0267   0366 F0 AC                beq LBL015
0268   0368 A5 BC       LBL017   lda $BC
0269   036A 85 2A                sta $2A
0270   036C A5 BD                lda $BD
0271   036E 85 2B                sta $2B
0272   0370 60                   rts
0273   0371             ;
0274   0371             ; Jump handling routine
0275   0371             ;
0276   0371 C9 40       LBL011   cmp #$40
0277   0373 B0 43                bcs LBL016                 ; If it's not a Jump, go to branch handler
0278   0375 48                   pha
0279   0376 20 F9 04             jsr LBL004                 ; Go read a byte from the TBIL table
0280   0379 6D 83 02             adc LBL002
0281   037C 85 BC                sta $BC
0282   037E 68                   pla
0283   037F 48                   pha
0284   0380 29 07                and #$07
0285   0382 6D 84 02             adc LBL002+$01
0286   0385 85 BD                sta $BD
0287   0387 68                   pla
0288   0388 29 08                and #$08
0289   038A D0 DC                bne LBL017
0290   038C A5 BC                lda $BC
0291   038E A6 2A                ldx $2A
0292   0390 85 2A                sta $2A
0293   0392 86 BC                stx $BC
0294   0394 A5 BD                lda $BD
0295   0396 A6 2B                ldx $2B
0296   0398 85 2B                sta $2B
0297   039A 86 BD                stx $BD
0298   039C A5 C6       LBL126   lda $C6
0299   039E E9 01                sbc #$01
0300   03A0 85 C6                sta $C6
0301   03A2 B0 02                bcs LBL018
0302   03A4 C6 C7                dec $C7
0303   03A6 C5 24       LBL018   cmp $24
0304   03A8 A5 C7                lda $C7
0305   03AA E5 25                sbc $25
0306   03AC 90 AA                bcc LBL019
0307   03AE A5 BC                lda $BC
0308   03B0 91 C6                sta ($C6),Y
0309   03B2 C8                   iny
0310   03B3 A5 BD                lda $BD
0311   03B5 91 C6                sta ($C6),Y
0312   03B7 60                   rts
0313   03B8             ;
0314   03B8             ;
0315   03B8             ; Branch Handler
0316   03B8             ;
0317   03B8 48          LBL016   pha
0318   03B9 4A                   lsr a
0319   03BA 4A                   lsr a
0320   03BB 4A                   lsr a
0321   03BC 4A                   lsr a
0322   03BD 29 0E                and #$0E
0323   03BF AA                   tax
0324   03C0 68                   pla
0325   03C1 C9 60                cmp #$60
0326   03C3 29 1F                and #$1F
0327   03C5 B0 02                bcs LBL020
0328   03C7 09 E0                ora #$E0
0329   03C9 18          LBL020   clc
0330   03CA F0 07                beq LBL021
0331   03CC 65 2A                adc $2A
0332   03CE 85 BC                sta $BC
0333   03D0 98                   tya
0334   03D1 65 2B                adc $2B
0335   03D3 85 BD       LBL021   sta $BD
0336   03D5 4C FC 02             jmp LBL022
0337   03D8             ;
0338   03D8             ;
0339   03D8             ;
0340   03D8 A5 2C       IL__BC   lda $2C                    ; Entry point for TBIL BC (String Match Branch)
0341   03DA 85 B8                sta $B8
0342   03DC A5 2D                lda $2D
0343   03DE 85 B9                sta $B9
0344   03E0 20 25 04    LBL025   jsr LBL023
0345   03E3 20 14 04             jsr LBL024
0346   03E6 51 2A                eor ($2A),Y
0347   03E8 AA                   tax
0348   03E9 20 F9 04             jsr LBL004                 ; Go read a byte from the TBIL table
0349   03EC 8A                   txa
0350   03ED F0 F1                beq LBL025
0351   03EF 0A                   asl a
0352   03F0 F0 12                beq LBL026
0353   03F2 A5 B8                lda $B8
0354   03F4 85 2C                sta $2C
0355   03F6 A5 B9                lda $B9
0356   03F8 85 2D                sta $2D
0357   03FA 4C 64 03    LBL028   jmp IL_FBR
0358   03FD 20 25 04    IL__BE   jsr LBL023                 ; Entry point for TBIL BE (Branch if not End of line)
0359   0400 C9 0D                cmp #$0D
0360   0402 D0 F6                bne LBL028
0361   0404 60          LBL026   rts
0362   0405             ;
0363   0405             ;
0364   0405             ;
0365   0405 20 25 04    IL__BV   jsr LBL023                 ; Entry point for TBIL BV (Branch if not Variable)
0366   0408 C9 5B                cmp #$5B
0367   040A B0 EE                bcs LBL028
0368   040C C9 41                cmp #$41
0369   040E 90 EA                bcc LBL028
0370   0410 0A                   asl a
0371   0411 20 87 05             jsr LBL029
0372   0414 A0 00       LBL024   ldy #$00
0373   0416 B1 2C                lda ($2C),Y
0374   0418 E6 2C                inc $2C
0375   041A D0 02                bne LBL030
0376   041C E6 2D                inc $2D
0377   041E C9 0D       LBL030   cmp #$0D
0378   0420 18                   clc
0379   0421 60                   rts
0380   0422             ;
0381   0422             ;
0382   0422             ;
0383   0422 20 14 04    LBL031   jsr LBL024
0384   0425 B1 2C       LBL023   lda ($2C),Y
0385   0427 C9 20                cmp #$20
0386   0429 F0 F7                beq LBL031
0387   042B C9 3A                cmp #$3A
0388   042D 18                   clc
0389   042E 10 02                bpl LBL032
0390   0430 C9 30                cmp #$30
0391   0432 60          LBL032   rts
0392   0433             ;
0393   0433             ;
0394   0433             ;
0395   0433 20 25 04    IL__BN   jsr LBL023                 ; Entry point for TBIL BN (Branch if not a Number)
0396   0436 90 C2                bcc LBL028
0397   0438 84 BC                sty $BC
0398   043A 84 BD                sty $BD
0399   043C A5 BC       LBL033   lda $BC
0400   043E A6 BD                ldx $BD
0401   0440 06 BC                asl $BC
0402   0442 26 BD                rol $BD
0403   0444 06 BC                asl $BC
0404   0446 26 BD                rol $BD
0405   0448 18                   clc
0406   0449 65 BC                adc $BC
0407   044B 85 BC                sta $BC
0408   044D 8A                   txa
0409   044E 65 BD                adc $BD
0410   0450 06 BC                asl $BC
0411   0452 2A                   rol a
0412   0453 85 BD                sta $BD
0413   0455 20 14 04             jsr LBL024
0414   0458 29 0F                and #$0F
0415   045A 65 BC                adc $BC
0416   045C 85 BC                sta $BC
0417   045E 98                   tya
0418   045F 65 BD                adc $BD
0419   0461 85 BD                sta $BD
0420   0463 20 25 04             jsr LBL023
0421   0466 B0 D4                bcs LBL033
0422   0468 4C 80 05             jmp LBL034
0423   046B 20 FC 06    LBL061   jsr IL__SP
0424   046E A5 BC                lda $BC
0425   0470 05 BD                ora $BD
0426   0472 F0 48                beq LBL036
0427   0474 A5 20       LBL065   lda $20
0428   0476 85 2C                sta $2C
0429   0478 A5 21                lda $21
0430   047A 85 2D                sta $2D
0431   047C 20 6D 05    LBL040   jsr LBL037
0432   047F F0 12                beq LBL038
0433   0481 A5 28                lda $28
0434   0483 C5 BC                cmp $BC
0435   0485 A5 29                lda $29
0436   0487 E5 BD                sbc $BD
0437   0489 B0 08                bcs LBL038
0438   048B 20 14 04    LBL039   jsr LBL024
0439   048E D0 FB                bne LBL039
0440   0490 4C 7C 04             jmp LBL040
0441   0493 A5 28       LBL038   lda $28
0442   0495 45 BC                eor $BC
0443   0497 D0 04                bne LBL041
0444   0499 A5 29                lda $29
0445   049B 45 BD                eor $BD
0446   049D 60          LBL041   rts
0447   049E             ;
0448   049E             ;
0449   049E             ;
0450   049E 20 A6 04    LBL043   jsr LBL042
0451   04A1 20 F9 04    IL__PC   jsr LBL004                 ; Entry point for TBIL PC (print literal) - Go read a byte from the TBIL table
0452   04A4 10 F8                bpl LBL043
0453   04A6 E6 BF       LBL042   inc $BF
0454   04A8 30 03                bmi LBL044
0455   04AA 4C 09 02             jmp OUT_V                  ; Go print it
0456   04AD C6 BF       LBL044   dec $BF
0457   04AF 60          LBL045   rts
0458   04B0             ;
0459   04B0             ;
0460   04B0             ;
0461   04B0 C9 22       LBL046   cmp #$22
0462   04B2 F0 FB                beq LBL045
0463   04B4 20 A6 04             jsr LBL042
0464   04B7 20 14 04    IL__PQ   jsr LBL024                 ; Entry point for TBIL PQ
0465   04BA D0 F4                bne LBL046
0466   04BC 4C 14 03    LBL036   jmp LBL015
0467   04BF A9 20       IL__PT   lda #$20                   ; Entry point for TBIL PT
0468   04C1 20 A6 04             jsr LBL042
0469   04C4 A5 BF                lda $BF
0470   04C6 29 87                and #$87
0471   04C8 30 E5                bmi LBL045
0472   04CA D0 F3                bne IL__PT
0473   04CC 60                   rts
0474   04CD             ;
0475   04CD             ;
0476   04CD             ;
0477   04CD A2 7B       IL__CP   ldx #$7B
0478   04CF 20 56 03             jsr LBL048
0479   04D2 E6 C1                inc $C1
0480   04D4 E6 C1                inc $C1
0481   04D6 E6 C1                inc $C1
0482   04D8 38                   sec
0483   04D9 B5 03                lda $03,X
0484   04DB F5 00                sbc $00,X
0485   04DD 95 00                sta $00,X
0486   04DF B5 04                lda $04,X
0487   04E1 F5 01                sbc $01,X
0488   04E3 50 04                bvc LBL052
0489   04E5 49 80                eor #$80
0490   04E7 09 01                ora #$01
0491   04E9 30 0A       LBL052   bmi LBL053
0492   04EB D0 04                bne LBL054
0493   04ED 15 00                ora $00,X
0494   04EF F0 02                beq LBL049
0495   04F1 56 02       LBL054   lsr $02,X
0496   04F3 56 02       LBL049   lsr $02,X
0497   04F5 56 02       LBL053   lsr $02,X
0498   04F7 90 0C                bcc LBL050
0499   04F9 A0 00       LBL004   ldy #$00                   ; Read a byte from the TBIL Table
0500   04FB B1 2A                lda ($2A),Y               ;
0501   04FD E6 2A                inc $2A                    ; Increment TBIL Table pointer as required
0502   04FF D0 02                bne LBL051                 ;
0503   0501 E6 2B                inc $2B                    ;
0504   0503 09 00       LBL051   ora #$00                   ; Check for $00 and set the 'Z' flag acordingly
0505   0505 60          LBL050   rts                        ; Return
0506   0506             ;
0507   0506             ;
0508   0506             ;
0509   0506 A5 BE       IL__NX   lda $BE                    ; Entry point for TBIL NX
0510   0508 F0 28                beq LBL055
0511   050A 20 14 04    LBL056   jsr LBL024
0512   050D D0 FB                bne LBL056
0513   050F 20 6D 05             jsr LBL037
0514   0512 F0 1B                beq LBL057
0515   0514 20 4C 05    LBL062   jsr LBL058
0516   0517 20 0C 02             jsr BV                     ; Test for break
0517   051A B0 09                bcs LBL059
0518   051C A5 C4                lda $C4
0519   051E 85 2A                sta $2A
0520   0520 A5 C5                lda $C5
0521   0522 85 2B                sta $2B
0522   0524 60                   rts
0523   0525             ;
0524   0525             ;
0525   0525             ;
0526   0525 AD 83 02    LBL059   lda LBL002
0527   0528 85 2A                sta $2A
0528   052A AD 84 02             lda LBL002+$01
0529   052D 85 2B                sta $2B
0530   052F 4C 14 03    LBL057   jmp LBL015
0531   0532 85 BF       LBL055   sta $BF
0532   0534 4C 49 03             jmp LBL060
0533   0537 A5 20       IL__XQ   lda $20                    ; Entry point fro TBIL XQ
0534   0539 85 2C                sta $2C
0535   053B A5 21                lda $21
0536   053D 85 2D                sta $2D
0537   053F 20 6D 05             jsr LBL037
0538   0542 F0 EB                beq LBL057
0539   0544 A5 2A                lda $2A
0540   0546 85 C4                sta $C4
0541   0548 A5 2B                lda $2B
0542   054A 85 C5                sta $C5
0543   054C A9 01       LBL058   lda #$01
0544   054E 85 BE                sta $BE
0545   0550 60                   rts
0546   0551             ;
0547   0551             ;
0548   0551             ;
0549   0551 20 6B 04    IL__GO   jsr LBL061                 ; Entry point for TBIL GO
0550   0554 F0 BE                beq LBL062
0551   0556 A5 BC       LBL066   lda $BC
0552   0558 85 28                sta $28
0553   055A A5 BD                lda $BD
0554   055C 85 29                sta $29
0555   055E 4C 14 03             jmp LBL015
0556   0561 20 FD 08    IL__RS   jsr LBL063                 ; Entry point for TBIL RS
0557   0564 20 F4 08             jsr LBL0GG
0558   0567 20 74 04             jsr LBL065
0559   056A D0 EA                bne LBL066
0560   056C 60                   rts
0561   056D             ;
0562   056D             ;
0563   056D             ;
0564   056D 20 14 04    LBL037   jsr LBL024
0565   0570 85 28                sta $28
0566   0572 20 14 04             jsr LBL024
0567   0575 85 29                sta $29
0568   0577 05 28                ora $28
0569   0579 60                   rts
0570   057A             ;
0571   057A             ;
0572   057A             ;
0573   057A 20 FC 06    IL__DS   jsr IL__SP                 ; Entry point for TBIL DS
0574   057D 20 80 05             jsr LBL034
0575   0580 A5 BD       LBL034   lda $BD
0576   0582 20 87 05    LBL131   jsr LBL029
0577   0585 A5 BC                lda $BC
0578   0587 A6 C1       LBL029   ldx $C1
0579   0589 CA                   dex
0580   058A 95 00                sta $00,X
0581   058C 86 C1                stx $C1
0582   058E E4 C0                cpx $C0
0583   0590 D0 0D                bne IL__NO
0584   0592 4C 14 03    LBL068   jmp LBL015
0585   0595 A6 C1       LBL097   ldx $C1
0586   0597 E0 80                cpx #$80
0587   0599 10 F7                bpl LBL068
0588   059B B5 00                lda $00,X
0589   059D E6 C1                inc $C1
0590   059F 60          IL__NO   rts                        ; Entry point for the TBIL NO
0591   05A0             ;
0592   05A0             ;
0593   05A0             ;
0594   05A0 85 BD       LBL010   sta $BD
0595   05A2 86 BC                stx $BC
0596   05A4 4C B8 05             jmp LBL069
0597   05A7 A6 C1       IL__PN   ldx $C1                    ; Entry point for the TBIL PN
0598   05A9 B5 01                lda $01,X
0599   05AB 10 08                bpl LBL070
0600   05AD 20 41 08             jsr IL__NE
0601   05B0 A9 2D                lda #$2D
0602   05B2 20 A6 04             jsr LBL042
0603   05B5 20 FC 06    LBL070   jsr IL__SP
0604   05B8 A9 1F       LBL069   lda #$1F
0605   05BA 85 B8                sta $B8
0606   05BC 85 BA                sta $BA
0607   05BE A9 2A                lda #$2A
0608   05C0 85 B9                sta $B9
0609   05C2 85 BB                sta $BB
0610   05C4 A6 BC                ldx $BC
0611   05C6 A4 BD                ldy $BD
0612   05C8 38                   sec
0613   05C9 E6 B8       LBL072   inc $B8
0614   05CB 8A                   txa
0615   05CC E9 10                sbc #$10
0616   05CE AA                   tax
0617   05CF 98                   tya
0618   05D0 E9 27                sbc #$27
0619   05D2 A8                   tay
0620   05D3 B0 F4                bcs LBL072
0621   05D5 C6 B9       LBL073   dec $B9
0622   05D7 8A                   txa
0623   05D8 69 E8                adc #$E8
0624   05DA AA                   tax
0625   05DB 98                   tya
0626   05DC 69 03                adc #$03
0627   05DE A8                   tay
0628   05DF 90 F4                bcc LBL073
0629   05E1 8A                   txa
0630   05E2 38          LBLe02   sec
0631   05E3 E6 BA       LBLe03   inc $BA
0632   05E5 E9 64       		 sbc #$64
0633   05E7 B0 FA                bcs LBLe03
0634   05E9 88                   dey
0635   05EA 10 F6                bpl LBLe02
0636   05EC C6 BB       LBL075   dec $BB
0637   05EE 69 0A                adc #$0A
0638   05F0 90 FA                bcc LBL075
0639   05F2 09 30                ora #$30
0640   05F4 85 BC                sta $BC
0641   05F6 A9 20                lda #$20
0642   05F8 85 BD                sta $BD
0643   05FA A2 FB                ldx #$FB
0644   05FC 86 C3       LBL199   stx $C3
0645   05FE B5 BD                lda $BD,X
0646   0600 05 BD                ora $BD
0647   0602 C9 20                cmp #$20
0648   0604 F0 09                beq LBL076
0649   0606 A0 30                ldy #$30
0650   0608 84 BD                sty $BD
0651   060A 05 BD                ora $BD
0652   060C 20 A6 04             jsr LBL042
0653   060F A6 C3       LBL076   ldx $C3
0654   0611 E8                   inx
0655   0612 D0 E8                bne LBL199
0656   0614 60                   rts
0657   0615             ;
0658   0615             ;
0659   0615             ;
0660   0615 A5 2D       IL__LS   lda $2D                    ; Entry point for TBIL LS
0661   0617 48                   pha
0662   0618 A5 2C                lda $2C
0663   061A 48                   pha
0664   061B A5 20                lda $20
0665   061D 85 2C                sta $2C
0666   061F A5 21                lda $21
0667   0621 85 2D                sta $2D
0668   0623 A5 24                lda $24
0669   0625 A6 25                ldx $25
0670   0627 20 5B 06             jsr LBL077
0671   062A F0 03                beq LBL078
0672   062C 20 5B 06             jsr LBL077
0673   062F A5 2C       LBL078   lda $2C
0674   0631 38                   sec
0675   0632 E5 B6                sbc $B6
0676   0634 A5 2D                lda $2D
0677   0636 E5 B7                sbc $B7
0678   0638 B0 42                bcs LBL079
0679   063A 20 6D 05             jsr LBL037
0680   063D F0 3D                beq LBL079
0681   063F A6 28                ldx $28
0682   0641 A5 29                lda $29
0683   0643 20 A0 05             jsr LBL010
0684   0646 A9 20                lda #$20
0685   0648 20 A6 04    LBL080   jsr LBL042
0686   064B 20 0C 02             jsr BV                     ; Test for break
0687   064E B0 2C                bcs LBL079
0688   0650 20 14 04             jsr LBL024
0689   0653 D0 F3                bne LBL080
0690   0655 20 83 06             jsr IL__NL
0691   0658 4C 2F 06             jmp LBL078
0692   065B 85 B6       LBL077   sta $B6
0693   065D E6 B6                inc $B6
0694   065F D0 01                bne LBL082
0695   0661 E8                   inx
0696   0662 86 B7       LBL082   stx $B7
0697   0664 A4 C1                ldy $C1
0698   0666 C0 80                cpy #$80
0699   0668 F0 18                beq LBL083
0700   066A 20 6B 04             jsr LBL061
0701   066D A5 2C       LBL099   lda $2C
0702   066F A6 2D                ldx $2D
0703   0671 38                   sec
0704   0672 E9 02                sbc #$02
0705   0674 B0 01                bcs LBL084
0706   0676 CA                   dex
0707   0677 85 2C       LBL084   sta $2C
0708   0679 4C 48 09             jmp LBL085
0709   067C 68          LBL079   pla
0710   067D 85 2C                sta $2C
0711   067F 68                   pla
0712   0680 85 2D                sta $2D
0713   0682 60          LBL083   rts
0714   0683 A5 BF       IL__NL   lda $BF                    ; Entry point for TBIL NL
0715   0685 30 FB                bmi LBL083
0716   0687             ;
0717   0687             ;
0718   0687             ; Routine to print a new line.  It handles CR, LF
0719   0687             ; and adds pad characters to the ouput
0720   0687             ;
0721   0687 A9 0D       P_NWLN   lda #$0D                   ; Load up a CR
0722   0689 20 09 02             jsr OUT_V                  ; Go print it
0723   068C AD 11 02             lda PCC                    ; Load the pad character code
0724   068F 29 7F                and #$7F                   ; Test to see - 
0725   0691 85 BF                sta $BF                    ; how many pad characters to print
0726   0693 F0 07                beq LBL086                 ; Skip if 0
0727   0695 20 64 09    LBL088   jsr LBL087                 ; Go print pad character
0728   0698 C6 BF                dec $BF                    ; One less
0729   069A D0 F9                bne LBL088                 ; Loop until 0
0730   069C A9 0A       LBL086   lda #$0A                   ; Load up a LF
0731   069E 4C 61 09             jmp LBL089                 ; Go print it
0732   06A1             ;
0733   06A1             ;
0734   06A1             ;
0735   06A1 AC 12 02    LBL092   ldy TMC
0736   06A4 84 BF       LBL091   sty $BF
0737   06A6 B0 0B                bcs LBL090
0738   06A8 A9 30       IL__GL   lda #$30                   ; Entry pont for TBIL GL
0739   06AA 85 2C                sta $2C
0740   06AC 85 C0                sta $C0
0741   06AE 84 2D                sty $2D
0742   06B0 20 80 05             jsr LBL034
0743   06B3 45 80       LBL090   eor $80
0744   06B5 85 80                sta $80
0745   06B7 20 06 02             jsr IN_V
0746   06BA A0 00                ldy #$00
0747   06BC A6 C0                ldx $C0
0748   06BE 29 7F                and #$7F
0749   06C0 F0 F1                beq LBL090
0750   06C2 C9 7F                cmp #$7F
0751   06C4 F0 ED                beq LBL090
0752   06C6 C9 13                cmp #$13
0753   06C8 F0 DA                beq LBL091
0754   06CA C9 0A                cmp #$0A
0755   06CC F0 D3                beq LBL092
0756   06CE CD 10 02             cmp LSC
0757   06D1 F0 09                beq LBL093
0758   06D3 CD 0F 02             cmp BSC
0759   06D6 D0 0A                bne LBL094
0760   06D8 E0 30                cpx #$30
0761   06DA D0 16                bne LBL095
0762   06DC A6 2C       LBL093   ldx $2C
0763   06DE 84 BF                sty $BF
0764   06E0 A9 0D                lda #$0D
0765   06E2 E4 C1       LBL094   cpx $C1
0766   06E4 30 08                bmi LBL096
0767   06E6 A9 07                lda #$07
0768   06E8 20 A6 04             jsr LBL042
0769   06EB 4C B3 06             jmp LBL090
0770   06EE 95 00       LBL096   sta $00,X
0771   06F0 E8                   inx
0772   06F1 E8                   inx
0773   06F2 CA          LBL095   dex
0774   06F3 86 C0                stx $C0
0775   06F5 C9 0D                cmp #$0D
0776   06F7 D0 BA                bne LBL090
0777   06F9 20 83 06             jsr IL__NL
0778   06FC 20 95 05    IL__SP   jsr LBL097                 ; Entry point for TBIL SP
0779   06FF 85 BC                sta $BC
0780   0701 20 95 05             jsr LBL097
0781   0704 85 BD                sta $BD
0782   0706 60                   rts
0783   0707             ;
0784   0707             ;
0785   0707             ;
0786   0707 20 D6 08    IL__IL   jsr LBL098                 ; Entry point for TBIL IL
0787   070A 20 6B 04             jsr LBL061
0788   070D 08                   php
0789   070E 20 6D 06             jsr LBL099
0790   0711 85 B8                sta $B8
0791   0713 86 B9                stx $B9
0792   0715 A5 BC                lda $BC
0793   0717 85 B6                sta $B6
0794   0719 A5 BD                lda $BD
0795   071B 85 B7                sta $B7
0796   071D A2 00                ldx #$00
0797   071F 28                   plp
0798   0720 D0 0B                bne LBL100
0799   0722 20 6D 05             jsr LBL037
0800   0725 CA                   dex
0801   0726 CA                   dex
0802   0727 CA          LBL101   dex
0803   0728 20 14 04             jsr LBL024
0804   072B D0 FA                bne LBL101
0805   072D 84 28       LBL100   sty $28
0806   072F 84 29                sty $29
0807   0731 20 D6 08             jsr LBL098
0808   0734 A9 0D                lda #$0D
0809   0736 D1 2C                cmp ($2C),Y
0810   0738 F0 11                beq LBL102
0811   073A E8                   inx
0812   073B E8                   inx
0813   073C E8                   inx
0814   073D E8          LBL103   inx
0815   073E C8                   iny
0816   073F D1 2C                cmp ($2C),Y
0817   0741 D0 FA                bne LBL103
0818   0743 A5 B6                lda $B6
0819   0745 85 28                sta $28
0820   0747 A5 B7                lda $B7
0821   0749 85 29                sta $29
0822   074B A5 B8       LBL102   lda $B8
0823   074D 85 BC                sta $BC
0824   074F A5 B9                lda $B9
0825   0751 85 BD                sta $BD
0826   0753 18                   clc
0827   0754 A0 00                ldy #$00
0828   0756 8A                   txa
0829   0757 F0 6E                beq LBL104
0830   0759 10 29                bpl LBL105
0831   075B 65 2E                adc $2E
0832   075D 85 B8                sta $B8
0833   075F A5 2F                lda $2F
0834   0761 E9 00                sbc #$00
0835   0763 85 B9                sta $B9
0836   0765 B1 2E       LBL109   lda ($2E),Y
0837   0767 91 B8                sta ($B8),Y
0838   0769 A6 2E                ldx $2E
0839   076B E4 24                cpx $24
0840   076D D0 06                bne LBL106
0841   076F A5 2F                lda $2F
0842   0771 C5 25                cmp $25
0843   0773 F0 4A                beq LBL107
0844   0775 E8          LBL106   inx
0845   0776 86 2E                stx $2E
0846   0778 D0 02                bne LBL108
0847   077A E6 2F                inc $2F
0848   077C E6 B8       LBL108   inc $B8
0849   077E D0 E5                bne LBL109
0850   0780 E6 B9                inc $B9
0851   0782 D0 E1                bne LBL109
0852   0784 65 24       LBL105   adc $24
0853   0786 85 B8                sta $B8
0854   0788 85 2E                sta $2E
0855   078A 98                   tya
0856   078B 65 25                adc $25
0857   078D 85 B9                sta $B9
0858   078F 85 2F                sta $2F
0859   0791 A5 2E                lda $2E
0860   0793 E5 C6                sbc $C6
0861   0795 A5 2F                lda $2F
0862   0797 E5 C7                sbc $C7
0863   0799 90 05                bcc LBL110
0864   079B C6 2A                dec $2A
0865   079D 4C 14 03             jmp LBL015
0866   07A0 B1 24       LBL110   lda ($24),Y
0867   07A2 91 2E                sta ($2E),Y
0868   07A4 A6 24                ldx $24
0869   07A6 D0 02                bne LBL111
0870   07A8 C6 25                dec $25
0871   07AA C6 24       LBL111   dec $24
0872   07AC A6 2E                ldx $2E
0873   07AE D0 02                bne LBL112
0874   07B0 C6 2F                dec $2F
0875   07B2 CA          LBL112   dex
0876   07B3 86 2E                stx $2E
0877   07B5 E4 BC                cpx $BC
0878   07B7 D0 E7                bne LBL110
0879   07B9 A6 2F                ldx $2F
0880   07BB E4 BD                cpx $BD
0881   07BD D0 E1                bne LBL110
0882   07BF A5 B8       LBL107   lda $B8
0883   07C1 85 24                sta $24
0884   07C3 A5 B9                lda $B9
0885   07C5 85 25                sta $25
0886   07C7 A5 28       LBL104   lda $28
0887   07C9 05 29                ora $29
0888   07CB F0 17                beq LBL113
0889   07CD A5 28                lda $28
0890   07CF 91 BC                sta ($BC),Y
0891   07D1 C8                   iny
0892   07D2 A5 29                lda $29
0893   07D4 91 BC                sta ($BC),Y
0894   07D6 C8          LBL114   iny
0895   07D7 84 B6                sty $B6
0896   07D9 20 14 04             jsr LBL024
0897   07DC 08                   php
0898   07DD A4 B6                ldy $B6
0899   07DF 91 BC                sta ($BC),Y
0900   07E1 28                   plp
0901   07E2 D0 F2                bne LBL114
0902   07E4 4C CC 02    LBL113   jmp LBL014
0903   07E7 20 54 03    IL__DV   jsr LBL115
0904   07EA B5 03                lda $03,X
0905   07EC 29 80                and #$80
0906   07EE F0 02                beq LBL116
0907   07F0 A9 FF                lda #$FF
0908   07F2 85 BC       LBL116   sta $BC
0909   07F4 85 BD                sta $BD
0910   07F6 48                   pha
0911   07F7 75 02                adc $02,X
0912   07F9 95 02                sta $02,X
0913   07FB 68                   pla
0914   07FC 48                   pha
0915   07FD 75 03                adc $03,X
0916   07FF 95 03                sta $03,X
0917   0801 68                   pla
0918   0802 55 01                eor $01,X
0919   0804 85 BB                sta $BB
0920   0806 10 03                bpl LBL117
0921   0808 20 43 08             jsr LBL118
0922   080B A0 11       LBL117   ldy #$11
0923   080D B5 00                lda $00,X
0924   080F 15 01                ora $01,X
0925   0811 D0 03                bne LBL119
0926   0813 4C 14 03             jmp LBL015
0927   0816 38          LBL119   sec
0928   0817 A5 BC                lda $BC
0929   0819 F5 00                sbc $00,X
0930   081B 48                   pha
0931   081C A5 BD                lda $BD
0932   081E F5 01                sbc $01,X
0933   0820 48                   pha
0934   0821 45 BD                eor $BD
0935   0823 30 0A                bmi LBL120
0936   0825 68                   pla
0937   0826 85 BD                sta $BD
0938   0828 68                   pla
0939   0829 85 BC                sta $BC
0940   082B 38                   sec
0941   082C 4C 32 08             jmp LBL121
0942   082F 68          LBL120   pla
0943   0830 68                   pla
0944   0831 18                   clc
0945   0832 36 02       LBL121   rol $02,X
0946   0834 36 03                rol $03,X
0947   0836 26 BC                rol $BC
0948   0838 26 BD                rol $BD
0949   083A 88                   dey
0950   083B D0 D9                bne LBL119
0951   083D A5 BB                lda $BB
0952   083F 10 0D                bpl LBL122
0953   0841 A6 C1       IL__NE   ldx $C1                    ; Entry point for TBIL NE
0954   0843 38          LBL118   sec
0955   0844 98                   tya
0956   0845 F5 00                sbc $00,X
0957   0847 95 00                sta $00,X
0958   0849 98                   tya
0959   084A F5 01                sbc $01,X
0960   084C 95 01                sta $01,X
0961   084E 60          LBL122   rts
0962   084F             ;
0963   084F             ;
0964   084F             ;
0965   084F 20 41 08    IL__SU   jsr IL__NE                 ; Entry point for TBIL SU
0966   0852 20 54 03    IL__AD   jsr LBL115                 ; Entry point for TBIL AD
0967   0855 B5 00                lda $00,X
0968   0857 75 02                adc $02,X
0969   0859 95 02                sta $02,X
0970   085B B5 01                lda $01,X
0971   085D 75 03                adc $03,X
0972   085F 95 03                sta $03,X
0973   0861 60                   rts
0974   0862             ;
0975   0862             ;
0976   0862             ;
0977   0862 20 54 03    IL__MP   jsr LBL115                 ; Entry point for TBIL MP
0978   0865 A0 10                ldy #$10
0979   0867 B5 02                lda $02,X
0980   0869 85 BC                sta $BC
0981   086B B5 03                lda $03,X
0982   086D 85 BD                sta $BD
0983   086F 16 02       LBL124   asl $02,X
0984   0871 36 03                rol $03,X
0985   0873 26 BC                rol $BC
0986   0875 26 BD                rol $BD
0987   0877 90 0D                bcc LBL123
0988   0879 18                   clc
0989   087A B5 02                lda $02,X
0990   087C 75 00                adc $00,X
0991   087E 95 02                sta $02,X
0992   0880 B5 03                lda $03,X
0993   0882 75 01                adc $01,X
0994   0884 95 03                sta $03,X
0995   0886 88          LBL123   dey
0996   0887 D0 E6                bne LBL124
0997   0889 60                   rts
0998   088A             ;
0999   088A             ;
1000   088A             ;
1001   088A 20 95 05    IL__FV   jsr LBL097                 ; Entry point for TBIL FV
1002   088D AA                   tax
1003   088E B5 00                lda $00,X
1004   0890 B4 01                ldy $01,X
1005   0892 C6 C1                dec $C1
1006   0894 A6 C1                ldx $C1
1007   0896 94 00                sty $00,X
1008   0898 4C 87 05             jmp LBL029
1009   089B A2 7D       IL__SV   ldx #$7D                   ; Entry point for TBIL SV
1010   089D 20 56 03             jsr LBL048
1011   08A0 B5 01                lda $01,X
1012   08A2 48                   pha
1013   08A3 B5 00                lda $00,X
1014   08A5 48                   pha
1015   08A6 20 95 05             jsr LBL097
1016   08A9 AA                   tax
1017   08AA 68                   pla
1018   08AB 95 00                sta $00,X
1019   08AD 68                   pla
1020   08AE 95 01                sta $01,X
1021   08B0 60                   rts
1022   08B1 20 FD 08    IL__RT   jsr LBL063
1023   08B4 A5 BC                lda $BC
1024   08B6 85 2A                sta $2A
1025   08B8 A5 BD                lda $BD
1026   08BA 85 2B                sta $2B
1027   08BC 60                   rts
1028   08BD             ;
1029   08BD             ;
1030   08BD             ;
1031   08BD A2 2C       IL__SB   ldx #$2C                   ; Entry point for TBIL SB 
1032   08BF D0 02                bne LBL125
1033   08C1 A2 2E       IL__RB   ldx #$2E                   ; Entry point for TBIL RB
1034   08C3 B5 00       LBL125   lda $00,X
1035   08C5 C9 80                cmp #$80
1036   08C7 B0 0D                bcs LBL098
1037   08C9 B5 01                lda $01,X
1038   08CB D0 09                bne LBL098
1039   08CD A5 2C                lda $2C
1040   08CF 85 2E                sta $2E
1041   08D1 A5 2D                lda $2D
1042   08D3 85 2F                sta $2F
1043   08D5 60                   rts
1044   08D6             ;
1045   08D6             ;
1046   08D6             ;
1047   08D6 A5 2C       LBL098   lda $2C
1048   08D8 A4 2E                ldy $2E
1049   08DA 84 2C                sty $2C
1050   08DC 85 2E                sta $2E
1051   08DE A5 2D                lda $2D
1052   08E0 A4 2F                ldy $2F
1053   08E2 84 2D                sty $2D
1054   08E4 85 2F                sta $2F
1055   08E6 A0 00                ldy #$00
1056   08E8 60                   rts
1057   08E9             ;
1058   08E9             ;
1059   08E9             ;
1060   08E9 A5 28       IL__GS   lda $28                    ; Entry point for TBIL GS
1061   08EB 85 BC                sta $BC
1062   08ED A5 29                lda $29
1063   08EF 85 BD                sta $BD
1064   08F1 20 9C 03             jsr LBL126
1065   08F4 A5 C6       LBL0GG   lda $C6
1066   08F6 85 26                sta $26
1067   08F8 A5 C7                lda $C7
1068   08FA 85 27       LBL064   sta $27
1069   08FC 60          LBL129   rts
1070   08FD             ;
1071   08FD             ;
1072   08FD             ;
1073   08FD B1 C6       LBL063   lda ($C6),Y
1074   08FF 85 BC                sta $BC
1075   0901 20 08 09             jsr LBL127
1076   0904 B1 C6                lda ($C6),Y
1077   0906 85 BD                sta $BD
1078   0908 E6 C6       LBL127   inc $C6
1079   090A D0 02                bne LBL128
1080   090C E6 C7                inc $C7
1081   090E A5 22       LBL128   lda $22
1082   0910 C5 C6                cmp $C6
1083   0912 A5 23                lda $23
1084   0914 E5 C7                sbc $C7
1085   0916 B0 E4                bcs LBL129
1086   0918 4C 14 03             jmp LBL015
1087   091B 20 24 09    IL__US   jsr LBL130
1088   091E 85 BC                sta $BC
1089   0920 98                   tya
1090   0921 4C 82 05             jmp LBL131
1091   0924 20 FC 06    LBL130   jsr IL__SP
1092   0927 A5 BC                lda $BC
1093   0929 85 B6                sta $B6
1094   092B 20 FC 06             jsr IL__SP
1095   092E A5 BD                lda $BD
1096   0930 85 B7                sta $B7
1097   0932 A4 BC                ldy $BC
1098   0934 20 FC 06             jsr IL__SP
1099   0937 A6 B7                ldx $B7
1100   0939 A5 B6                lda $B6
1101   093B 18                   clc
1102   093C 6C BC 00             jmp ($00BC)
1103   093F 20 42 09    IL__LN   jsr IL__LB                 ; Entry point for TBIL LN
1104   0942 20 F9 04    IL__LB   jsr LBL004                 ; Entry point for TBIL LB - Go read a byte from the IL table
1105   0945 4C 87 05             jmp LBL029
1106   0948 86 2D       LBL085   stx $2D
1107   094A E0 00                cpx #$00
1108   094C 60                   rts
1109   094D             ;
1110   094D             ;
1111   094D             ;
1112   094D A0 02       ILRES2   ldy #$02                   ; These two entry points are for code that
1113   094F 84 BC       ILRES1   sty $BC                    ;  does not seem to get called.  Need more research.
1114   0951 A0 0B                ldy #$0B
1115   0953 84 BD                sty $BD
1116   0955 A0 00                ldy #$00
1117   0957 B1 BC                lda ($BC),Y
1118   0959 C9 08                cmp #$08
1119   095B D0 03                bne LBL133
1120   095D 4C 68 03             jmp LBL017
1121   0960 60          LBL133   rts
1122   0961             ;
1123   0961             ;
1124   0961             ; Subroutine to decide which pad characters to print
1125   0961             ;
1126   0961 20 09 02    LBL089   jsr OUT_V                  ; Entry point with a character to print first
1127   0964 A9 FF       LBL087   lda #$FF                   ; Normal entry point - Set pad to $FF !ho  patch TO 00
1128   0966 2C 11 02             bit PCC                    ; Check if the pad flag is on
1129   0969 30 02                bmi LBL134                 ; Skip it if not
1130   096B A9 00                lda #$00                   ; set pad to $00
1131   096D 4C 09 02    LBL134   jmp OUT_V                  ; Go print it
1132   0970             
1133   0970             
1134   0970             ;
1135   0970             ; TBIL program table
1136   0970             ;
1137   0970 24 3E 80 27 ILTBL    .byte $24, $3E, $80, $27, $10, $E1, $59, $C5, $2A, $56, $10, $11, $2C, $8B, $4C
1137   0974 10 E1 59 C5 
1137   0978 2A 56 10 11 
1137   097C 2C 8B 4C 
1138   097F 45 D4 A0 80          .byte $45, $D4, $A0, $80, $BD, $30, $BC, $E0, $13, $1D, $94, $47, $CF, $88, $54
1138   0983 BD 30 BC E0 
1138   0987 13 1D 94 47 
1138   098B CF 88 54 
1139   098E CF 30 BC E0          .byte $CF, $30, $BC, $E0, $10, $11, $16, $80, $53, $55, $C2, $30, $BC, $E0, $14
1139   0992 10 11 16 80 
1139   0996 53 55 C2 30 
1139   099A BC E0 14 
1140   099D 16 90 50 D2          .byte $16, $90, $50, $D2, $83, $49, $4E, $D4, $E5, $71, $88, $BB, $E1, $1D, $8F
1140   09A1 83 49 4E D4 
1140   09A5 E5 71 88 BB 
1140   09A9 E1 1D 8F 
1141   09AC A2 21 58 6F          .byte $A2, $21, $58, $6F, $83, $AC, $22, $55, $83, $BA, $24, $93, $E0, $23, $1D
1141   09B0 83 AC 22 55 
1141   09B4 83 BA 24 93 
1141   09B8 E0 23 1D 
1142   09BB 30 BC 20 48          .byte $30, $BC, $20, $48, $91, $49, $C6, $30, $BC, $31, $34, $30, $BC, $84, $54
1142   09BF 91 49 C6 30 
1142   09C3 BC 31 34 30 
1142   09C7 BC 84 54 
1143   09CA 48 45 CE 1C          .byte $48, $45, $CE, $1C, $1D, $38, $0D, $9A, $49, $4E, $50, $55, $D4, $A0, $10
1143   09CE 1D 38 0D 9A 
1143   09D2 49 4E 50 55 
1143   09D6 D4 A0 10 
1144   09D9 E7 24 3F 20          .byte $E7, $24, $3F, $20, $80, $27, $E1, $59, $81, $AC, $30, $BC, $13, $11, $82
1144   09DD 80 27 E1 59 
1144   09E1 81 AC 30 BC 
1144   09E5 13 11 82 
1145   09E8 AC 4D E0 1D          .byte $AC, $4D, $E0, $1D, $89, $52, $45, $54, $55, $52, $CE, $E0, $15, $1D, $85
1145   09EC 89 52 45 54 
1145   09F0 55 52 CE E0 
1145   09F4 15 1D 85 
1146   09F7 45 4E C4 E0          .byte $45, $4E, $C4, $E0, $2D, $98, $4C, $49, $53, $D4, $EC, $24, $00, $00, $00
1146   09FB 2D 98 4C 49 
1146   09FF 53 D4 EC 24 
1146   0A03 00 00 00 
1147   0A06 00 0A 80 1F          .byte $00, $0A, $80, $1F, $24, $93, $23, $1D, $30, $BC, $E1, $50, $80, $AC, $59
1147   0A0A 24 93 23 1D 
1147   0A0E 30 BC E1 50 
1147   0A12 80 AC 59 
1148   0A15 85 52 55 CE          .byte $85, $52, $55, $CE, $38, $0A, $86, $43, $4C, $45, $41, $D2, $2B, $84, $52
1148   0A19 38 0A 86 43 
1148   0A1D 4C 45 41 D2 
1148   0A21 2B 84 52 
1149   0A24 45 CD 1D A0          .byte $45, $CD, $1D, $A0, $80, $BD, $38, $14, $85, $AD, $30, $D3, $17, $64, $81
1149   0A28 80 BD 38 14 
1149   0A2C 85 AD 30 D3 
1149   0A30 17 64 81 
1150   0A33 AB 30 D3 85          .byte $AB, $30, $D3, $85, $AB, $30, $D3, $18, $5A, $85, $AD, $30, $D3, $19, $54
1150   0A37 AB 30 D3 18 
1150   0A3B 5A 85 AD 30 
1150   0A3F D3 19 54 
1151   0A42 2F 30 E2 85          .byte $2F, $30, $E2, $85, $AA, $30, $E2, $1A, $5A, $85, $AF, $30, $E2, $1B, $54
1151   0A46 AA 30 E2 1A 
1151   0A4A 5A 85 AF 30 
1151   0A4E E2 1B 54 
1152   0A51 2F 98 52 4E          .byte $2F, $98, $52, $4E, $C4, $0A, $80, $80, $12, $0A, $09, $29, $1A, $0A, $1A
1152   0A55 C4 0A 80 80 
1152   0A59 12 0A 09 29 
1152   0A5D 1A 0A 1A 
1153   0A60 85 18 13 09          .byte $85, $18, $13, $09, $80, $12, $01, $0B, $31, $30, $61, $72, $0B, $04, $02
1153   0A64 80 12 01 0B 
1153   0A68 31 30 61 72 
1153   0A6C 0B 04 02 
1154   0A6F 03 05 03 1B          .byte $03, $05, $03, $1B, $1A, $19, $0B, $09, $06, $0A, $00, $00, $1C, $17, $2F
1154   0A73 1A 19 0B 09 
1154   0A77 06 0A 00 00 
1154   0A7B 1C 17 2F 
1155   0A7E 8F 55 53 D2          .byte $8F, $55, $53, $D2, $80, $A8, $30, $BC, $31, $2A, $31, $2A, $80, $A9, $2E
1155   0A82 80 A8 30 BC 
1155   0A86 31 2A 31 2A 
1155   0A8A 80 A9 2E 
1156   0A8D 2F A2 12 2F          .byte $2F, $A2, $12, $2F, $C1, $2F, $80, $A8, $30, $BC, $80, $A9, $2F, $83, $AC
1156   0A91 C1 2F 80 A8 
1156   0A95 30 BC 80 A9 
1156   0A99 2F 83 AC 
1157   0A9C 38 BC 0B 2F          .byte $38, $BC, $0B, $2F, $80, $A8, $52, $2F, $84, $BD, $09, $02, $2F, $8E, $BC
1157   0AA0 80 A8 52 2F 
1157   0AA4 84 BD 09 02 
1157   0AA8 2F 8E BC 
1158   0AAB 84 BD 09 93          .byte $84, $BD, $09, $93, $2F, $84, $BE, $09, $05, $2F, $09, $91, $2F, $80, $BE
1158   0AAF 2F 84 BE 09 
1158   0AB3 05 2F 09 91 
1158   0AB7 2F 80 BE 
1159   0ABA 84 BD 09 06          .byte $84, $BD, $09, $06, $2F, $84, $BC, $09, $95, $2F, $09, $04, $2F
1159   0ABE 2F 84 BC 09 
1159   0AC2 95 2F 09 04 
1159   0AC6 2F 
1160   0AC7 00 00 00             .byte $00, $00, $00
1161   0ACA             ; End of Tiny Basic
1162   0ACA             
1163   0ACA             ;
1164   0ACA             ;  BREAK TEST FOR KIM
1165   0ACA             ; 
1166   0ACA AD 40 17    KIMBT	lda	KTTY			;Look at TTY bit PB7
1167   0ACD 18          		clc					;C=O IF IDLE
1168   0ACE 30 0E       		bmi	KIMX			;IDLE
1169   0AD0 AD 40 17    		lda	KTTY			;WAIT FOR END
1170   0AD3 10 FB       		bpl	*-3
1171   0AD5 20 D8 0A    KLDY	jsr	KIMDL
1172   0AD8 A9 FF       KIMDL	lda	#255			;DELAY 2 RUBOUT TIMES
1173   0ADA 20 A0 1E    		jsr	OUTCH
1174   0ADD 38          		sec					; C=1 IF BREAK
1175   0ADE 60          KIMX	rts
1176   0ADF             ;
1177   0ADF             ;  BREAK TEST FOR TIM
1178   0ADF             ; 
1179   0ADF             ;TIMBT    lda	#$01		; if TTY bit 1 then there is incoming character?
1180   0ADF             ;		 bit 	MPB 
1181   0ADF             ;		 clc
1182   0ADF             ;    	 beq	TIMBT1		
1183   0ADF             ;TIMBT2	 bit	MPB 		; wait till TTY bit PB0 is 0 
1184   0ADF             ;		 bne 	TIMBT2
1185   0ADF             ;		 sec
1186   0ADF             ;TIMBT1	 rts		 
1187   0ADF             
1188   0ADF             
1189   0ADF             .end


Label        Value      Label        Value      Label        Value
------------------      ------------------      ------------------
BV            020C      BSC           020F      CV            0200      
COLD_S        0285      ERRSTR        027E      FREERAM       0B00      
GETCH         1E5A      IN_V          0206      IL__MT        02AA      
IL_BBR        0362      IL_FBR        0364      IL__BC        03D8      
IL__BE        03FD      IL__BV        0405      IL__BN        0433      
IL__PC        04A1      IL__PQ        04B7      IL__PT        04BF      
IL__CP        04CD      IL__NX        0506      IL__XQ        0537      
IL__GO        0551      IL__RS        0561      IL__DS        057A      
IL__NO        059F      IL__PN        05A7      IL__LS        0615      
IL__NL        0683      IL__GL        06A8      IL__SP        06FC      
IL__IL        0707      IL__DV        07E7      IL__NE        0841      
IL__SU        084F      IL__AD        0852      IL__MP        0862      
IL__FV        088A      IL__SV        089B      IL__RT        08B1      
IL__SB        08BD      IL__RB        08C1      IL__GS        08E9      
IL__US        091B      IL__LN        093F      IL__LB        0942      
ILRES2        094D      ILRES1        094F      ILTBL         0970      
KTTY          1740      KIMBT         0ACA      KLDY          0AD5      
KIMDL         0AD8      KIMX          0ADE      LSC           0210      
LBL008        021D      LBL002        0283      LBL014        02CC      
LBL006        02E6      LBL005        02F2      LBL022        02FC      
LBL007        0306      LBL015        0314      LBL012        0341      
LBL060        0349      LBL115        0354      LBL048        0356      
LBL019        0358      LBL017        0368      LBL011        0371      
LBL126        039C      LBL018        03A6      LBL016        03B8      
LBL020        03C9      LBL021        03D3      LBL025        03E0      
LBL028        03FA      LBL026        0404      LBL024        0414      
LBL030        041E      LBL031        0422      LBL023        0425      
LBL032        0432      LBL033        043C      LBL061        046B      
LBL065        0474      LBL040        047C      LBL039        048B      
LBL038        0493      LBL041        049D      LBL043        049E      
LBL042        04A6      LBL044        04AD      LBL045        04AF      
LBL046        04B0      LBL036        04BC      LBL052        04E9      
LBL054        04F1      LBL049        04F3      LBL053        04F5      
LBL004        04F9      LBL051        0503      LBL050        0505      
LBL056        050A      LBL062        0514      LBL059        0525      
LBL057        052F      LBL055        0532      LBL058        054C      
LBL066        0556      LBL037        056D      LBL034        0580      
LBL131        0582      LBL029        0587      LBL068        0592      
LBL097        0595      LBL010        05A0      LBL070        05B5      
LBL069        05B8      LBL072        05C9      LBL073        05D5      
LBLe02        05E2      LBLe03        05E3      LBL075        05EC      
LBL199        05FC      LBL076        060F      LBL078        062F      
LBL080        0648      LBL077        065B      LBL082        0662      
LBL099        066D      LBL084        0677      LBL079        067C      
LBL083        0682      LBL088        0695      LBL086        069C      
LBL092        06A1      LBL091        06A4      LBL090        06B3      
LBL093        06DC      LBL094        06E2      LBL096        06EE      
LBL095        06F2      LBL101        0727      LBL100        072D      
LBL103        073D      LBL102        074B      LBL109        0765      
LBL106        0775      LBL108        077C      LBL105        0784      
LBL110        07A0      LBL111        07AA      LBL112        07B2      
LBL107        07BF      LBL104        07C7      LBL114        07D6      
LBL113        07E4      LBL116        07F2      LBL117        080B      
LBL119        0816      LBL120        082F      LBL121        0832      
LBL118        0843      LBL122        084E      LBL124        086F      
LBL123        0886      LBL125        08C3      LBL098        08D6      
LBL0GG        08F4      LBL064        08FA      LBL129        08FC      
LBL063        08FD      LBL127        0908      LBL128        090E      
LBL130        0924      LBL085        0948      LBL133        0960      
LBL089        0961      LBL087        0964      LBL134        096D      
MEM_T         0293      OUTCH         1EA0      OUT_V         0209      
PCC           0211      PEEK          0214      PULL          02A6      
P_NWLN        0687      START         0200      SSS           0213      
SRVT          0222      TMC           0212      TOP           02A9      
WV            0203      WARM_S        02BD      

tasm: Number of errors = 0
